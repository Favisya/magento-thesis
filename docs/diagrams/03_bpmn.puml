@startuml
title Процесс мониторинга фоновых задач (BPMN)

|Планировщик|
start
:Запуск задач мониторинга;

fork
  |Мониторинг Cron|
  :StuckCronChecker;
  :Анализ запущенных cron-задач;
  
  if (Проблемы?) then (Да)
    :Подготовка данных;
    :ErrorHandler;
    
    |Система уведомлений|
    :Отправка алерта;
  else (Нет)
    :Логирование;
  endif
  
fork again
  |Мониторинг RabbitMQ|
  :UpdateConsumerStatus;
  :Анализ консьюмеров;
  
  if (Проблемы?) then (Да)
    :Формирование данных;
    
    |Система уведомлений|
    :Отправка алерта;
  else (Нет)
    :Логирование;
  endif

fork again
  |Мониторинг Индексов|
  :IndexerMonitor;
  :Анализ индексаторов;
  
  if (Проблемы?) then (Да)
    :Классификация проблемы;
    :ErrorHandler;
    
    |Система уведомлений|
    :Отправка алерта;
  else (Нет)
    :Логирование;
  endif

fork again
  |Мониторинг Daemon|
  :DaemonMonitor;
  :Анализ daemon-процессов;
  
  if (Проблемы?) then (Да)
    :Классификация проблемы;
    :ErrorHandler;
    
    |Система уведомлений|
    :Отправка алерта;
  else (Нет)
    :Логирование;
  endif

fork again
  |Анализ Логов|
  :LogMonitor;
  :Анализ системных логов;
  :Фильтрация по критериям;
  
  if (Критические ошибки?) then (Да)
    :Выделение контекста ошибки;
    :Сохранение информации о критических ошибках;
  else (Нет)
    :Сохранение статистики;
  endif
end fork

|Журналирование|
:Обновление статистики;

|Завершение|
:Ожидание следующего запуска;
stop
@enduml 