@startuml
!define activity(x) :x;
skinparam activity {
  BackgroundColor #FEFECE
  BorderColor #666666
  ArrowColor #666666
}

title Диаграмма деятельности: Мониторинг фоновых процессов

' Начало процесса
start

' Мониторинг процессов
:Мониторинг фоновых процессов;
if (Обнаружен сбой?) then (Да)
  :Анализ типа сбоя;
  if (Тип сбоя?) then (Cron)
    :Проверка зависших задач;
    :Проверка таймаутов;
  else if (RabbitMQ) then
    :Проверка состояния очередей;
    :Проверка потребителей;
  else if (Индексы) then
    :Проверка состояния индексов;
    :Проверка времени обновления;
  else if (Демоны) then
    :Проверка процессов;
    :Проверка ресурсов;
  else if (Логи) then
    :Чтение файлов логов;
    :Фильтрация ошибок;
    :Анализ критичности записей;
    :Выделение контекста;
  endif

  :Оценка критичности;
  if (Критический сбой?) then (Да)
    :Экстренное оповещение;
    :Сбор информации о сбое;
    :Логирование критического сбоя;
  else (Нет)
    :Стандартное оповещение;
    :Логирование проблемы;
  endif

  :Обновление метрик;
  :Обновление статистики;
endif

' Конец процесса
stop

' Легенда
legend right
  |= Обозначение |= Значение |
  | if/else | Условный переход |
  | :действие; | Действие |
  | start/stop | Начало/конец процесса |
endlegend

@enduml
